using System;
using OpenAI;
using OpenAI.Chat;
using Microsoft.Agents.AI;
using Microsoft.Agents.AI.OpenAI;

// 1. Initialize the standard OpenAI Client
// Replace "your-api-key" with your actual OpenAI API key
var apiKey = "sk-proj-your-key-here";
var client = new OpenAIClient(apiKey);

// 2. Configure GPT-5 with High Reasoning Effort
var options = new OpenAIModelOptions
{
    // High effort ensures the model uses internal tokens to solve the logic
    ReasoningEffort = ReasoningEffort.High 
};

// 3. Create the Agent using the OpenAI ChatClient
AIAgent puzzleAgent = client.GetChatClient("gpt-5")
    .CreateAIAgent(
        name: "PuzzleSolver",
        instructions: """
            You are a logic engine. When given a puzzle:
            - Think through the constraints silently first.
            - Output the solution as a series of clear, numbered steps.
            - End with a final 'Solution:' line.
            """,
        options: options
    );

// 4. Conversation Loop
var thread = puzzleAgent.GetNewThread();

Console.WriteLine("=== GPT-5 Standard OpenAI Puzzle Solver ===");
Console.Write("Enter your puzzle: ");
string? puzzle = Console.ReadLine();

if (!string.IsNullOrEmpty(puzzle))
{
    Console.WriteLine("\nAnalyzing puzzle (Reasoning: High)...\n");

    // Stream the result to see the steps as they are generated
    await foreach (var update in thread.RunStreamingAsync(puzzle))
    {
        if (update is TextContentUpdate textUpdate)
        {
            Console.Write(textUpdate.Text);
        }
    }
}

Console.WriteLine("\n\nDone.");
